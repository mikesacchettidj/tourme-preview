"use client";
import React,{useEffect,useMemo,useState} from "react";
import {useParams} from "next/navigation";
import {SHOWS} from "../../_data";
import {Calendar,ArrowLeft,Share2,FileDown,Printer,CheckSquare,Square,FileText,Plane,TrainFront,Car,MapPin} from "lucide-react";
const DEFAULT_CHECKS=["Tech rider confirmed","Rider received","Transport booked","Crew assigned","Contract signed","Visa approved","Hotel booked"];
function Section({title,children}:{title:string;children:React.ReactNode}){return(<section className="rounded-2xl border card-surface border-zinc-200 p-4 dark:border-zinc-800"><div className="mb-2 text-sm font-medium">{title}</div>{children}</section>);}
export default function ShowFullPage(){const params=useParams<{slug:string}>();const slug=(params?.slug as string)||"";const show=useMemo(()=>SHOWS.find(s=>s.slug===slug),[slug]);const [store,setStore]=useState<any>({});useEffect(()=>{try{const raw=localStorage.getItem(`show:${slug}`);if(raw)setStore(JSON.parse(raw));}catch{}},[slug]);const toggle=(k:string)=>{const prev=store||{};const checklist={...(prev.checklist||Object.fromEntries(DEFAULT_CHECKS.map(n=>[n,false]))),[k]:!prev?.checklist?.[k]};const next={...prev,checklist};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}};const exportCSV=()=>{const names=(store.guestNames||"").split(/\r?\n/).filter(Boolean);const rows=["Name",...names];const csv=rows.map(r=>`"${r.replaceAll('"','""')}"`).join("\n");const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`${slug}-guestlist.csv`;a.click();URL.revokeObjectURL(url);};if(!show)return<div className="p-6">Not found</div>;const done=Object.values(store.checklist||{}).filter(Boolean).length;const total=DEFAULT_CHECKS.length;return(<div className="mx-auto max-w-6xl px-4 py-6"><header className="mb-6 flex items-center gap-3 no-print"><a href="/" className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800 flex items-center gap-1">Back</a><div className="ml-1 text-lg font-semibold">{show.name}</div><div className="ml-2 text-sm text-zinc-500">{show.date} • {show.venue} — {show.city}</div><div className="ml-auto flex items-center gap-2"><button onClick={()=>window.print()} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800 flex items-center gap-1">Day Sheet</button><button onClick={exportCSV} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800 flex items-center gap-1">Export CSV</button><button className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800 flex items-center gap-1">Share</button></div></header><div className="grid grid-cols-1 gap-6 md:grid-cols-2"><div className="flex flex-col gap-4"><Section title="Overview"><div className="text-sm"><div className="font-medium">{show.name}</div><div className="text-zinc-500 flex items-center gap-2">{show.date} • {show.venue} — {show.city}</div><div className="mt-2">Doors 22:00 • Set 01:00–02:30</div><div className="text-zinc-500">Soundcheck 20:00</div></div></Section><Section title={`Checklist (${done}/${total})`}><ul className="space-y-2 text-sm">{DEFAULT_CHECKS.map(k=>{const checked=!!(store.checklist||{})[k];return(<li key={k}><button onClick={()=>toggle(k)} className="flex w-full items-center gap-2 rounded-lg px-2 py-1 text-left hover:bg-zinc-100 dark:hover:bg-zinc-900"><span className="inline-block h-4 w-4 rounded border border-zinc-400 text-center text-[10px] leading-4">{checked?'✓':''}</span><span className={checked?"line-through opacity-70":""}>{k}</span></button></li>);})}</ul></Section><Section title="Notes"><textarea rows={6} placeholder="Add special notes…" className="w-full rounded-xl border border-zinc-300 bg-transparent p-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={store.notes||""} onChange={(e)=>{const next={...store,notes:e.target.value};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}}} /></Section></div><div className="flex flex-col gap-4"><Section title="Files"><div className="grid grid-cols-1 gap-3 md:grid-cols-2"><div className="flex items-center gap-2"><FileText className="h-4 w-4"/><input placeholder="Contract URL" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={store.files?.contract||""} onChange={(e)=>{const next={...store,files:{...(store.files||{}),contract:e.target.value}};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}}} /></div><div className="flex items-center gap-2"><FileText className="h-4 w-4"/><input placeholder="Rider URL" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={store.files?.rider||""} onChange={(e)=>{const next={...store,files:{...(store.files||{}),rider:e.target.value}};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}}} /></div></div></Section><Section title="Guestlist"><input placeholder="Submission link (URL)" className="mb-2 w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={store.guestLink||""} onChange={(e)=>{const next={...store,guestLink:e.target.value};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}}} /><textarea rows={5} placeholder="Names (one per line)" className="w-full rounded-xl border border-zinc-300 bg-transparent p-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={store.guestNames||""} onChange={(e)=>{const next={...store,guestNames:e.target.value};setStore(next);try{localStorage.setItem(`show:${slug}`,JSON.stringify(next));}catch{}}} /><div className="mt-2 flex items-center justify-between"><div className="text-xs text-zinc-500">{(store.guestNames||"").split(/\r?\n/).filter(Boolean).length} names</div><button onClick={exportCSV} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800">Export CSV</button></div></Section><Section title="Travel"><div className="grid grid-cols-1 gap-3 md:grid-cols-2"><div className="flex items-center gap-2"><Plane className="h-4 w-4"/><input placeholder="Flight (e.g. LH123 10:35 → 12:05)" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div><div className="flex items-center gap-2"><Car className="h-4 w-4"/><input placeholder="Ground (pickup, car/van details)" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div><div className="flex items-center gap-2"><TrainFront className="h-4 w-4"/><input placeholder="Train (optional)" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div><div className="flex items-center gap-2"><MapPin className="h-4 w-4"/><input placeholder="Hotel / Address" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div></div></Section><Section title="Budget (lite)"><div className="grid grid-cols-3 gap-3"><div><div className="text-xs text-zinc-500">Fee</div><input placeholder="€ 2,000" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div><div><div className="text-xs text-zinc-500">Buyout/Per-diem</div><input placeholder="€ 40 x 3" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div><div><div className="text-xs text-zinc-500">Expenses</div><input placeholder="€ 350 est." className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" /></div></div></Section></div></div><div className="print-area hidden"><h1>{show.name} — Day Sheet</h1><p>{show.date} — {show.venue} — {show.city}</p><p>Doors 22:00 • Set 01:00–02:30 • Soundcheck 20:00</p></div></div>);}
