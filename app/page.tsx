"use client";
import React,{Suspense,useEffect,useState} from "react";
import {Calendar,MapPin,Users,FileText,Receipt,MessageSquare,LayoutDashboard,BarChart3,Folder,Moon,Sun,Plus,Bell,HelpCircle,Settings} from "lucide-react";
import {SHOWS,Show} from "./_data";
function FlipCard({front,back}:{front:React.ReactNode;back:React.ReactNode}){
 const [flipped,setFlipped]=useState(false);
 return(<div onClick={()=>setFlipped(v=>!v)} className="group perspective cursor-pointer">
  <div className={`relative h-48 w-64 [transform-style:preserve-3d] transition-transform duration-500 ${flipped?"[transform:rotateY(180deg)]":""}`}>
   <div className="absolute inset-0 backface-hidden rounded-2xl border card-surface border-zinc-200 bg-white p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-900">{front}</div>
   <div className="absolute inset-0 backface-hidden rounded-2xl border card-surface border-zinc-200 bg-zinc-50 p-4 shadow-sm dark:border-zinc-800 dark:bg-zinc-800 [transform:rotateY(180deg)]">{back}</div>
  </div></div>);}
const DEFAULT_CHECKS=["Tech rider confirmed","Rider received","Transport booked","Crew assigned","Contract signed","Visa approved","Hotel booked"];
type ShowStore={files:{contract?:string;rider?:string},transport?:'flight'|'train'|'car'|'van'|null,checklist:Record<string,boolean>,notes?:string,guestLink?:string,guestNames?:string};
function useShowStore(slug:string){const key=`show:${slug}`;const [data,setData]=useState<ShowStore>({files:{},transport:null,checklist:Object.fromEntries(DEFAULT_CHECKS.map(k=>[k,false])),notes:'',guestLink:'',guestNames:''});useEffect(()=>{try{const raw=localStorage.getItem(key);if(raw)setData(prev=>({...prev,...JSON.parse(raw)}));}catch{}},[slug]);const save=(next:Partial<ShowStore>)=>setData(prev=>{const merged={...prev,...next};try{localStorage.setItem(key,JSON.stringify(merged));}catch{}return merged;});return {data,save};}
function ShowPanel({show,onClose}:{show:Show;onClose:()=>void}){const {data,save}=useShowStore(show.slug);return(<><div onClick={onClose} className="fixed inset-0 z-40 bg-black/40 backdrop-blur-sm"/><aside className="fixed right-0 top-0 z-50 h-full w-[min(40vw,640px)] overflow-y-auto border-l border-zinc-200 bg-white p-5 dark:border-zinc-800 dark:bg-zinc-950"><div className="sticky top-0 z-10 -mx-5 mb-4 flex items-center justify-between border-b border-zinc-200 bg-white/80 px-5 py-3 backdrop-blur dark:border-zinc-800 dark:bg-zinc-950/70"><div className="min-w-0"><div className="truncate text-lg font-semibold">{show.name}</div><div className="truncate text-sm text-zinc-500">{show.date} • {show.venue} — {show.city}</div></div><div className="flex items-center gap-2"><span className="rounded-full border border-zinc-300 px-2 py-0.5 text-xs dark:border-zinc-700">{show.status??"—"}</span><a href={`/shows/${show.slug}`} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800">View full page</a><button onClick={onClose} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800">Close</button></div></div><div className="flex flex-col gap-4"><div className="rounded-2xl border border-zinc-200 p-4 dark:border-zinc-800"><div className="mb-2 text-sm font-medium">Schedule</div><div className="text-sm"><div>Doors 22:00 • Set 01:00–02:30</div><div className="text-zinc-500">Soundcheck 20:00</div></div></div><div className="rounded-2xl border border-zinc-200 p-4 dark:border-zinc-800"><div className="mb-2 text-sm font-medium">Quick files</div><div className="grid grid-cols-1 gap-3 md:grid-cols-2"><div className="flex items-center gap-2"><FileText className="h-4 w-4"/><input placeholder="Contract URL" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={data.files.contract??''} onChange={e=>save({files:{...data.files,contract:e.target.value}})} /></div><div className="flex items-center gap-2"><FileText className="h-4 w-4"/><input placeholder="Rider URL" className="w-full rounded-lg border border-zinc-300 bg-transparent px-2 py-1 text-sm outline-none focus:ring-2 focus:ring-zinc-300 dark:border-zinc-700" value={data.files.rider??''} onChange={e=>save({files:{...data.files,rider:e.target.value}})} /></div></div></div><div className="rounded-2xl border border-zinc-200 p-4 dark:border-zinc-800"><div className="mb-2 text-sm font-medium">Checklist</div><ul className="space-y-2 text-sm">{DEFAULT_CHECKS.map(k=>{const checked=!!data.checklist[k];return(<li key={k}><button onClick={()=>save({checklist:{...data.checklist,[k]:!checked}})} className="flex w-full items-center gap-2 rounded-lg px-2 py-1 text-left hover:bg-zinc-100 dark:hover:bg-zinc-900"><span className="inline-block h-4 w-4 rounded border border-zinc-400 text-center text-[10px] leading-4">{checked?'✓':''}</span><span className={checked?'line-through opacity-70':''}>{k}</span></button></li>);})}</ul></div></div></aside></>);}
export default function Page(){const [theme,setTheme]=useState<'graphite'|'deep'>('graphite');const [active,setActive]=useState<string|null>(null);useEffect(()=>{const root=document.documentElement;root.classList.add('dark');root.classList.remove('theme-graphite','theme-deep');root.classList.add(theme==='graphite'?'theme-graphite':'theme-deep');},[theme]);useEffect(()=>{const update=()=>{const p=new URLSearchParams(window.location.search);setActive(p.get('show'));};update();window.addEventListener('popstate',update);return()=>window.removeEventListener('popstate',update);},[]);const close=()=>{const p=new URLSearchParams(window.location.search);p.delete('show');const q=p.toString();window.history.pushState({},'',q?`/?${q}`:'/');window.dispatchEvent(new PopStateEvent('popstate'));};return(<Suspense fallback={<div className="p-4">Loading...</div>}><div><header className="sticky top-0 z-30 border-b border-zinc-200/60 bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60 dark:border-zinc-800/60 dark:bg-zinc-950/60"><div className="mx-auto flex max-w-7xl items-center gap-3 px-4 py-3"><div className="font-black tracking-tight text-xl">TOUR.ME</div><nav className="mx-4 hidden items-center gap-1 rounded-full bg-zinc-100 p-1 dark:bg-zinc-900 md:flex"><button className="flex items-center gap-2 rounded-full px-3 py-1.5 text-sm hover:bg-white hover:shadow dark:hover:bg-zinc-800"><LayoutDashboard className="h-4 w-4" /><span>Dashboard</span></button><button className="flex items-center gap-2 rounded-full px-3 py-1.5 text-sm hover:bg-white hover:shadow dark:hover:bg-zinc-800"><Calendar className="h-4 w-4" /><span>Calendar</span></button><button className="flex items-center gap-2 rounded-full px-3 py-1.5 text-sm hover:bg-white hover:shadow dark:hover:bg-zinc-800"><Folder className="h-4 w-4" /><span>Files</span></button><button className="flex items-center gap-2 rounded-full px-3 py-1.5 text-sm hover:bg-white hover:shadow dark:hover:bg-zinc-800"><BarChart3 className="h-4 w-4" /><span>Insights</span></button></nav><div className="ml-auto flex items-center gap-2"><div className="hidden sm:flex items-center gap-1 rounded-full border border-zinc-300 px-1 py-0.5 text-xs dark:border-zinc-700"><button onClick={()=>setTheme('graphite')} className={`rounded-full px-2 py-1 ${theme==='graphite'?'bg-zinc-200 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100':''}`}>Graphite</button><button onClick={()=>setTheme('deep')} className={`rounded-full px-2 py-1 ${theme==='deep'?'bg-zinc-200 text-zinc-900 dark:bg-zinc-800 dark:text-zinc-100':''}`}>Deep Black</button></div><button className="rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-900" aria-label="Help"><HelpCircle className="h-5 w-5" /></button><button className="rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-900" aria-label="Settings"><Settings className="h-5 w-5" /></button><button className="rounded-full p-2 hover:bg-zinc-100 dark:hover:bg-zinc-900" aria-label="Notifications"><Bell className="h-5 w-5" /></button><button className="rounded-full bg-zinc-900 px-3 py-1.5 text-sm text-white hover:opacity-90 dark:bg-zinc-100 dark:text-zinc-900" aria-label="Add Event"><Plus className="mr-1 inline h-4 w-4" /> Add Event</button><div className="ml-1 h-8 w-8 overflow-hidden rounded-full bg-zinc-200" /></div></div></header><div className="mx-auto grid max-w-7xl grid-cols-12 gap-6 px-4 py-6"><aside className="col-span-12 md:col-span-3 lg:col-span-2"><div className="sticky top-[68px] flex flex-col gap-6"><div><div className="mb-2 text-xs uppercase tracking-wide text-zinc-500">Navigation</div><nav className="flex flex-col gap-1"><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><Calendar className="h-4 w-4"/><span>Agenda</span></a><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><MapPin className="h-4 w-4"/><span>Tours & Shows</span></a><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><Users className="h-4 w-4"/><span>Contacts</span></a><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><FileText className="h-4 w-4"/><span>Documents</span></a><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><Receipt className="h-4 w-4"/><span>Expenses</span></a><a className="flex items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 dark:hover:bg-zinc-900" href="#"><MessageSquare className="h-4 w-4"/><span>Chat</span></a></nav></div></div></aside><main className="col-span-12 md:col-span-9 lg:col-span-10"><section className="mb-8"><h2 className="mb-1 text-2xl font-semibold">Shows</h2><p className="mb-4 text-sm text-zinc-500">Scheduled performances and gigs</p><div className="grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">{SHOWS.map(s=>(<FlipCard key={s.slug} front={<div className="flex h-full w-full flex-col justify-between rounded-xl"><div className="text-xl font-semibold">{s.name}<span className="ml-2 text-zinc-400">{s.date}</span></div><div className="text-sm text-zinc-500">@ {s.venue}<br/>{s.city}</div></div>} back={<div className="flex h-full w-full flex-col justify-between"><div><div className="text-sm text-zinc-400">Details</div><div className="mt-1 text-base">Doors 22:00 • Set 01:00–02:30</div><div className="text-sm text-zinc-500">Soundcheck 20:00 • Contact: Alex (Promoter)</div></div><div className="flex items-center justify-between text-sm"><span className="text-zinc-500">Status: {s.status??'—'}</span><a href={`/shows/${s.slug}`} onClick={(e)=>e.stopPropagation()} className="rounded-lg border border-zinc-300 px-2 py-1 text-xs hover:bg-zinc-100 dark:border-zinc-700 dark:hover:bg-zinc-800">Open</a></div></div>} />))}</div></section><section><h2 className="mb-1 text-2xl font-semibold">People</h2><p className="mb-4 text-sm text-zinc-500">Artists, promoters, venues, tech crew and more</p><div className="grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6">{['Maria','Petra','Josh','Patrizia','Jason','Damian'].map((name,i)=>(<div key={i} className="rounded-2xl border card-surface border-zinc-200 p-3 dark:border-zinc-800"><div className="h-24 w-full rounded-xl bg-gradient-to-br from-zinc-200 to-zinc-300 dark:from-zinc-800 dark:to-zinc-700" /><div className="mt-2 text-sm font-medium">{name}</div><div className="text-xs text-zinc-500">{['Booker','Event Manager','Promoter','Artist','Event Manager','Tech'][i]}</div></div>))}</div></section></main></div>{active && (()=>{const s=SHOWS.find(x=>x.slug===active);return s?<ShowPanel show={s} onClose={close}/>:null})()}</div></Suspense>);}
